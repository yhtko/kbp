了解です！
**Codex（または GitHub Copilot）にそのまま渡しても崩れない “完全な Markdown 仕様書（実装テンプレ）”** を作成します。

---

# ✅ 要件

* **Web Add-in の最小構成（manifest + HTML + JS + CSS + アイコン）**
* **kintone API 用の実装テンプレを含む**
* **静的ホスティング前提（サーバー不要）**
* **コードブロックはすべて Markdown で綺麗に分離**
* **Codex が理解しやすい構造**

---

# 📄 **WebAddIn_KintoneConnector.md（完成版）**

以下を **そのまま MD ファイルとして保存し、Codex に投げてください。**

---

```markdown
# Kintone Connector Web Add-in for Excel  
（Static hosting / No server required）

このドキュメントは、Excel 用の Web Add-in を使って  
**kintone のレコードを取得し、Excel に書き込む Add-in** の最小テンプレートです。

- Excel 2019 / 2021 / Microsoft 365 に対応  
- manifest.xml をユーザーが読み込むだけ  
- HTML / JS / CSS は静的ホスティング  
- サーバー不要  
- APIキー・ドメイン・AppID はユーザー側で入力（提供者側で保持しない）

---

# 1. フォルダ構成

```

kintone-excel-addin/
├─ manifest.xml
└─ web/
├─ index.html
├─ taskpane.js
├─ styles.css
├─ icon-32.png
├─ icon-80.png
└─ icon-128.png

````

web フォルダは静的サイトとして公開する（GitHub Pages など）

---

# 2. manifest.xml

`YOUR_HOST_DOMAIN` を公開URLに置き換えて使用。

```xml
<?xml version="1.0" encoding="UTF-8"?>
<OfficeApp
  xmlns="http://schemas.microsoft.com/office/appforoffice/1.1"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0"
  xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides"
  xsi:type="TaskPaneApp">

  <Id>c6e5a6d0-1234-4a89-9f11-9c0f1e0a0001</Id>
  <Version>1.0.0.0</Version>
  <ProviderName>Yahata Kintone Connector</ProviderName>
  <DefaultLocale>ja-JP</DefaultLocale>

  <DisplayName DefaultValue="Kintone Connector for Excel" />
  <Description DefaultValue="kintoneのレコードをExcelに取り込むWebアドイン" />

  <IconUrl DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/icon-32.png" />
  <HighResolutionIconUrl DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/icon-80.png" />

  <SupportUrl DefaultValue="https://YOUR_HOST_DOMAIN/" />

  <AppDomains>
    <AppDomain>https://YOUR_HOST_DOMAIN</AppDomain>
  </AppDomains>

  <Hosts>
    <Host Name="Workbook" />
  </Hosts>

  <DefaultSettings>
    <SourceLocation DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/index.html" />
  </DefaultSettings>

  <Permissions>ReadWriteDocument</Permissions>

  <VersionOverrides Version="1.0" xsi:type="ov:VersionOverrides">
    <ov:Hosts>
      <ov:Host xsi:type="ov:Workbook">
        <ov:DesktopFormFactor>
          <ov:ExtensionPoint xsi:type="ov:PrimaryCommandSurface">
            <ov:OfficeTab id="TabHome">
              <ov:Group id="Yahata.Kintone.Group" label="Kintone" insertAfterMso="GroupClipboard">
                <ov:Control xsi:type="ov:Button" id="Yahata.Kintone.OpenTaskpane">
                  <ov:Label resid="residButtonLabel" />
                  <ov:Supertip>
                    <ov:Title resid="residButtonLabel" />
                    <ov:Description resid="residButtonTooltip" />
                  </ov:Supertip>
                  <ov:Icon>
                    <ov:IconSize xsi:type="ov:IconSize16">
                      <ov:Image resid="residIcon16" />
                    </ov:IconSize>
                    <ov:IconSize xsi:type="ov:IconSize32">
                      <ov:Image resid="residIcon32" />
                    </ov:IconSize>
                    <ov:IconSize xsi:type="ov:IconSize80">
                      <ov:Image resid="residIcon80" />
                    </ov:IconSize>
                  </ov:Icon>
                  <ov:Action xsi:type="ov:ShowTaskpane">
                    <ov:TaskpaneId>ButtonTaskPane1</ov:TaskpaneId>
                    <ov:SourceLocation resid="residTaskpaneUrl" />
                  </ov:Action>
                </ov:Control>
              </ov:Group>
            </ov:OfficeTab>
          </ov:ExtensionPoint>
        </ov:DesktopFormFactor>
      </ov:Host>
    </ov:Hosts>

    <ov:Resources>
      <ov:Strings>
        <ov:String id="residButtonLabel">
          <ov:DefaultValue>Kintone連携</ov:DefaultValue>
        </ov:String>
        <ov:String id="residButtonTooltip">
          <ov:DefaultValue>Kintoneからレコードを取得してシートに書き込みます。</ov:DefaultValue>
        </ov:String>
      </ov:Strings>

      <ov:Images>
        <ov:Image id="residIcon16" resid="residIcon16Url" />
        <ov:Image id="residIcon32" resid="residIcon32Url" />
        <ov:Image id="residIcon80" resid="residIcon80Url" />
      </ov:Images>

      <ov:Urls>
        <ov:Url id="residTaskpaneUrl" DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/index.html" />
        <ov:Url id="residIcon16Url" DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/icon-32.png" />
        <ov:Url id="residIcon32Url" DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/icon-80.png" />
        <ov:Url id="residIcon80Url" DefaultValue="https://YOUR_HOST_DOMAIN/kintone-excel-addin/web/icon-128.png" />
      </ov:Urls>
    </ov:Resources>
  </VersionOverrides>
</OfficeApp>
````

---

# 3. index.html（タスクペイン UI）

```html
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <title>Kintone Connector</title>

  <script src="https://appsforoffice.microsoft.com/lib/1/hosted/office.js"></script>
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <h2>Kintone Connector</h2>

  <label>ドメイン</label>
  <input id="domain" placeholder="xxx.cybozu.com" />

  <label>アプリID</label>
  <input id="appId" />

  <label>APIトークン</label>
  <input id="token" type="password" />

  <label>条件（query）</label>
  <input id="condition" placeholder='例: 作業日 >= "2024-01-01"' />

  <button id="fetchButton">取得してExcelに書き込む</button>

  <script src="taskpane.js"></script>
</body>
</html>
```

---

# 4. taskpane.js（Excel + kintone ロジック）

```javascript
// Excel loaded
Office.onReady(() => {
  document.getElementById("fetchButton").onclick = fetchKintone;
});

async function fetchKintone() {
  const domain = document.getElementById("domain").value.trim();
  const appId = document.getElementById("appId").value.trim();
  const token = document.getElementById("token").value.trim();
  const condition = document.getElementById("condition").value.trim();

  if (!domain || !appId || !token) {
    alert("ドメイン・アプリID・APIトークンは必須です");
    return;
  }

  const limit = 500;
  let offset = 0;
  let allRecords = [];

  while (true) {
    const query =
      (condition ? condition + " " : "") +
      `order by $id asc limit ${limit} offset ${offset}`;

    const url = `https://${domain}/k/v1/records.json?app=${appId}&query=${encodeURIComponent(
      query
    )}`;

    const res = await fetch(url, {
      headers: { "X-Cybozu-API-Token": token },
    });

    if (!res.ok) {
      alert("kintone API エラー: " + res.status);
      return;
    }

    const json = await res.json();
    const records = json.records;

    if (!records.length) break;

    allRecords = allRecords.concat(records);
    offset += limit;
  }

  // flatten: type/value → value
  const flat = allRecords.map((rec) => {
    const out = {};
    for (const key in rec) {
      out[key] = rec[key].value;
    }
    return out;
  });

  writeToExcel(flat);
}

async function writeToExcel(rows) {
  await Excel.run(async (ctx) => {
    const sheet = ctx.workbook.worksheets.getActiveWorksheet();

    if (rows.length === 0) {
      sheet.getRange("A1").values = [["データなし"]];
      return;
    }

    const headers = Object.keys(rows[0]);
    const data = [headers, ...rows.map((r) => headers.map((h) => r[h] ?? ""))];

    const range = sheet.getRangeByIndexes(0, 0, data.length, headers.length);
    range.values = data;
    range.format.autofitColumns();
    range.format.autofitRows();

    await ctx.sync();
  });

  alert("書き込み完了");
}
```

---

# 5. styles.css

```css
body {
  font-family: sans-serif;
  padding: 16px;
}

label {
  display: block;
  margin-top: 12px;
}

input {
  width: 100%;
  padding: 6px;
  margin-top: 4px;
}

button {
  margin-top: 20px;
  padding: 10px 16px;
  width: 100%;
  background: #0078d4;
  color: white;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

button:hover {
  background: #005fa3;
}
```

---

# 6. アイコン

以下サイズで適当なPNGを置けばOK：

* icon-32.png
* icon-80.png
* icon-128.png

---

# 7. デプロイ手順

1. `web/` フォルダを GitHub Pages / 静的サイトにアップロード
2. manifest.xml 内の `YOUR_HOST_DOMAIN` を修正
3. manifest.xml をユーザーに配布
4. Excel → 挿入 → アドイン → 個人用アドイン → XML を追加
5. タスクペインから接続

---

# 8. 注意点（Codex にとって重要）

* Office.js は非同期が多いので async/await を維持する
* CORS は kintone が許可しているため fetch が直接可能
* manifest の URL は絶対パス
* フォルダ構造を崩すと Add-in が読み込めない

---

# End of file

```

---

# 📌 この MD をそのまま Codex に投げれば…

- manifest.xml  
- index.html  
- taskpane.js  
- styles.css  
- アイコン  
- デプロイ手順  

全部を理解して補完しながら開発できます。

必要なら、「kintone アプリ名で検索するUI追加」「複数アプリ対応」「Excelテーブル書き込み強化」など拡張版も作れます。
```
